#![allow(unused_imports)]

use subxt::{
    OnlineClient, PolkadotConfig, backend::rpc::RpcClient,
    config::PolkadotConfig as SrcChainConfig, ext::subxt_rpcs::LegacyRpcMethods,
    storage::DynamicAddress,
};
use subxt_signer::sr25519::dev;

#[subxt::subxt(runtime_metadata_path = "revive_chain.metadata")]
pub mod polkadot {}

use polkadot::system::calls::types::Remark;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let client = OnlineClient::<PolkadotConfig>::new().await?;

    let code = hex::decode(
        "50564d0000d419000000000000010700c13000c0008004809909000000000e0000001c0000002a000000300000003b00000046000000580000006300000063616c6c5f646174615f636f707963616c6c5f646174615f6c6f616463616c6c5f646174615f73697a6563616c6c65726765745f73746f726167657365616c5f72657475726e7365745f696d6d757461626c655f646174617365745f73746f7261676576616c75655f7472616e73666572726564051102919c0463616c6c91a4066465706c6f7906990b808d0295432b00730141029702510356038603c203290434045d04660479048504ab04e404e904f304fc04010509050e051005260549050b064f068c06d6062a072f073407e8071c0864089f08f008230931093a095a095f096109690972099b09a009a209fb09000a400a450a470a780afa0aff0a010b0c0b110b1a0b1f0b550b5a0b640b6a0b700b760b7f0bbc0bc60bd30b2f0c460c5b0c970cc50ccf0c3a0d550d6c0d720d780db20dcc0dd20dd40d090e180e1e0e200e2d0e330e3d0e430e520e580e620e680ee10ee70ef00e2d0f370f4a0f500f520f5c0fc70fe20ff90fff0f05103d1056105c105e106b1071107b10811090109610a010a610ac10b210bb10f71001110e112611351150116c116e119a11a411ad11b311bd11c311390808000251086b04330730000383770a06285e049511f07b10087b15648964753308206497501002dc027c78017c797c7a027c7b03978808d4980897aa1097bb18d4ba0ad4a8087c79057c7a047c7b067c7c07979908d4a90997bb1097cc18d4cb0bd4b909979920d489027c79097c7a087c7b0a7c7c0b979908d4a90997bb1097cc18d4cb0bd4b9097c7a0d7c7b0c7c7c0e7c780f97aa08d4ba0a97cc10978818d4c808d4a808978820d498037c78117c7a107c7b127c7c13978808d4a80897bb1097cc18d4cb0bd4b8087c7a157c7b147c7c167c791797aa08d4ba0a97cc10979918d4c909d4a909979920d4890a7c78197c79187c7b1a7c7c1b978808d4980897bb1097cc18d4cb0bd4b8087c791d7c7b1c7c7c1e7c771f979908d4b90997cc10977718d4c707d49707977720d487076f776fa86f396f2a7b5a187b59107b58087b57821008821595111032009511d87b10207b15187b161082897b19088289087b1982851082861833082050100494016f686f59821a6faa821b086fbb787b18787a10787908787898bc38787c1f98bc30787c1e98bc28787c1d98bc20787c1c98bc18787c1b98bc10787c1a98bb08787b1998ab38787b1798ab30787b1698ab28787b1598ab20787b1498ab18787b1398ab10787b1298aa08787a11989a38787a0f989a30787a0e989a28787a0d989a20787a0c989a18787a0b989a10787a0a98990878790998893878790798893078790698892878790598892078790498891878790398891078790298880878780182102082151882161095112832006f776f996faa6f887b18187b1a107b19087b17491138491130491128491120481140208318831a20831b403309ff33070a04821738821830821928821a206f776f886f996faa7b6a187b69107b68087b67501208331032009511a07b10587b15509515608411e08272827a08827b108277188283828908828c108288186f746fbb6faa6f276f826fcc6f996f387b17187b1a107b1b087b147b18387b19307b1c287b12208318831a203309ff330b2033070a079551a082105882155095116032008b7910520931c8780883881f8488e05638000001253309040002390a040002ae8a093d080400020133081000028377c887073200009511f07b10087b158475010a02013d0700000251050750100a0950100c3401951140ff7b10b8007b15b0007b16a8009515c0008411e0491178491170491160800033074095186049116850100ecefd49219800492190004921880049218000831780000a0801821790008218980082198800821a8000d49808d4a707d487075207a2009517405010105f04821840821748821950821a587b1a387b19307b17289517207b1820330012951160ff7b1098007b1590007b1688009515a0008411f08279827808827a108277184911784911704911684911607b17587b1a507b18489517609518407b194033006033024c285d106417330014330228287d0f8217188218108219088216d49707d48609d47909989920d48707977720d4970751070900501016b60c64673308501018a1fe8377330833090a2893fb6467330850101a8efe83783307330933001c0a05019511a07b10587b15509515608411e049111849111049018000330740641849110850101ea9fc39070000025317043483172033080a010181173c330830dec53baa872e33088f6af960aa871b33083aa1d473ab870d3300203302e800285f0e5010222a0c3300243302b40028500e33002633027228470e501228b20e33084050102a11fb50122c950d320049111849111049014133070464184911085010302efc390804000256183f0b20030400024001330810000283883307013309243300320a05019511b07b10487b15407b16389515508411f064728289827408828c088273959a1fd89a00c80c0984aae07b1308c8a303d8a30bc8490ac8ba0ad39a06d89a07da6b07822b18d8c90c828610822210828818da000cc86c0cd86c06c82c09c89707d8c90cd89709c8b808c86808c8c808c8980c8ec88e79dbc809d4c7088ea6db8906520652821808d88308d34a09d84a06da9806d82708d3bc09d8bc0bda980bd32708d49808da860b520b2b7b13107b1a187b17203307409518107b1c2850103449fb9551b082104882154082163895115032003300369511b07b10487b15409515508411f0491130491128491120140700000000717b484e9518207b1738330733002e2803fb951140ff7b10b8007b15b0007b16a8009515c0008411f082897b19388289087b19308289107b19288288187b182064769517800033003833022828250d821980007b19821788007b1718821a90007b1a10821b98007b1b088218207b18588218287b18508218307b18488218387b18407b1b787b1a707b17689517609518407b196050103a78fe8217087b67188217107b67108217187b670882177b67955140ff8210b8008215b0008216a8009511c0003200828910828a18828b088288d4ba0ad4980bd4ab0b98bb20d4a909979920d4b90952091450123c890c50103eebf85012406f0b320000951150ff7b10a8007b15a0007b1698009515b0008411f0828410828308829608828c7b1c10829b829210d3360a7b1a28d8360ad8cb0c821028da0c0a64308288187b18208298187b1818c94209c9a9087b1828d8a9087b1408d8420a821420821310821918c94909c9a909c98909c90606c9c608c93b0a8e8c88aa2085aa01db8c0a8f968218288e8cdb960cd49808db8c0a510a4e64767b13507b10588217087b17609517709518507b14685010421fff8217800082188800821970821a787b67107b68187b697b6a08955150ff8210a8008215a000821698009511b0003200501044f708951110ff7b10e8007b15e0007b16d8009515f0008411f039080000027b17207b18289787209879204921a8004921a000492198009517b000951890007b19187b199000501046f0fd8218c8008219c0008217b8008216b0007b17107b18d48707d49608d478089888207b1908d49707977720d4870752079100646782182850104868fa837782182833090a821718c86707d86708821c10c88c03d8c30ada880a821b08c8ba0ad8ba088219c889027b17307b19687b1b607b1c587b16507b13387b1a409517709518509519307b124850104a4cfe8217800082188800821970821a78821b207bb7107bb8187bb97bba08955110ff8210e8008215e0008216d8009511f0003200008289107b190882861850124e960b33005033020628560a7b16788217087b17708217107b17688217187b176095174095186050105244f9501254870b32008086105012585e0b33005a330206281e0a801734977720821838d467078219107b19688219187b19607b18787b177095174095186050105c03f950125e460b3200330610000383670a033a0718000339082000033a091000036f77977a206f88988820d48a0a9877206f98978920d49707988820491118491138491130491128491120017b18107b170895172064187b1a330062330256288b0a501264e60a3200827218828318827b10827c088289088274828a828810d3c907d8c909d84a0adb790ac9b807d8a707d8b808c92309c98909c979095709053200501066d306501268ce07320052083f9511d07b10287b15209515308411f0827a18827810827b0882777b177b1b087b181064187b1a18649750106cdcf69551d08210288215209511303200009511807b10787b15707b1668951580008411f07b171082878292828b08829308957a207b1a18d87a06c86b0a7b1a08d8ba0cda660c828a10828818829410829918c8ca06d8a60cc88c0c7b1c7b18387b1a307b1b287b17207b19587b14507b13489517409518207b124033006e33026a286a095012703f0932003300740a08330276289e095012769b095207a500501278fb0750107ae8fe9517c00033007c9511a07b10587b15507b16489515608411f064764911184911104911089517206418490133000e0133020801283b0850127ec20833008000330228284d08502282006106502084001dff50228600fd0752073f50228800ad06c9c602d8c606d84a0a821c38c99c0cc9ac0cc96c0cc9b707c98707c90306d4c707d42608d47808d42707988820977720d4870751070a0050208a0058056407646850208c0042f783788369330733008e000a05019511887b10707b15687b16607b174082977b17508297087b17588297107b174882921882861882891082858288088e6a8e9bdb6a0b8e8a885c000185cc01db8a0cd46909db9b0c7b1c388359807b1564267b1218642850209000ce087b17307b182083597b192882175082185850209200b7087b17107b18088d598000821748646850209400c808821508d485058219889a80007b1a08821820daa805821858da9805821610d47606821730daa706821750da97068217488218188219285020960066088219089398939782193894969495949794988219407b98187b97107b95087b96821070821568821660951178320033009a0033020628c1068217607b17508217687b17588212708218787b1848821c3898c73d976903d4970798663d821a2897a903d4960698a93d821a4097aa03d4a90997cc037b1c408e7a88cb000185bb01db7a0b8e978e6adb970ad46909db9a0b7b1b2883c98064267b1210642750209c00c3077b17187b18208217388a79037b193882175082185850209e00a8077b177b18088218408d89800064678218485020a000b7075022a2006a055020a4008507821893879777209877208218289486821950948994878218304918187b87107b897b8608955140ff8210b8008215b0008216a8009511c00032004911200195174095182064194911283300a800330298002883045022aa00fa0532005208439511d07b10287b15209515308411f0827810827a088277978820988b204911187b177b1a0864187b1b1064975020ae004cf39551d08210288215209511303200005022b200210632003300b6000a083302b800287d065022b8007a065207f4005022ba00d9045020bc00c5fb9517c0003300be003302a60028a0055022c000c5053300c200330228284f055022c40063033300c6009511807b10787b15707b1668951580008411f07b171082878292828b08829308957a207b1a18d87a06c86b0a7b1a08d8ba0cda660c828a10828818829410829918c8ca06d8a60cc88c0c7b1c7b18387b1a307b1b287b17207b19587b14507b13489517409518207b12403300b0003302ac002883055022c8008c0452073f5022ca003c03c9c602d8c606d84a0a821c38c99c0cc9ac0cc96c0cc9b707c98707c90306d4c707d42608d47808d42707988820977720d4870751070a005020cc00e701640764685020ce00d1f38378836933073300d0000a053302d20028c7025022d200c40232003300d6003302062834048217607b17508217687b17588212708218787b1848821c3898c73d976903d4970798663d821a2897a903d4960698a93d821a4097aa03d4a90997cc037b1c408e7a88cb000185bb01db7a0b8e978e6adb970ad46909db9a0b7b1b2883c98064267b121064275020d80036057b17187b18208217388a79037b19388217508218585020da001b057b177b18088218408d89800064678218485020dc002a055022de00dd025020e000f8048219939793988219289496821a50949a949894978219307b97107b98187b9a7b9608955140ff8210b8008215b0008216a8009511c000320049112895174095182064194911203300e4003302d40028f9015022e600700332003300ea000a083302ec00283f045022ec003c04520781005022ee009b025020f00087f99517c0003300f2003302e2002862035022f40087033300f6003302282811035022f80025015020fa00e1f95022fc00c10252073f5022fe007101c9c602d8c606d84a0a821c38c99c0cc9ac0cc96c0cc9b707c98707c90306d4c707d42608d47808d42707988820977720d4870751070900502000011c640764685020020107f2837883693307330004010a05019511f87b10330810000283883307013309330006010a05013308491718491710491708490732007b17387b19307b1a287b1820641795182033000a013302062840028217108218188219821a087b67107b68187b697b6a0850220c015f01320033021001821730821838821920821a287b67107b68187b697b6a089551a08210588215508216489511603200320033075020120199f13307015020140190f15022160101023300180133022828f40150221a01e10032008217b8007b17188216b0008218a8007b1810821aa0007b1a088219207b19588219287b19508219307b19488219387b19407b17787b16707b1868951780009518609519407b1a603202828918828a10828b0882887b79187b7a107b7b087b783202646482178800821898007b183882138000821a9000d3b706d8b70cd80308da680cc94a063202951140ff7b10b8007b15b0007b16a8009515c0008411e07b17308297187b17408297107b172882960882977b1738828718828910828a0882887b1798007b1990007b1a88007b1880009517609518800032028217108218188219821a087b67107b68187b697b6a089551c082103882153082162895114032029551a08210588215508216489511603202821ad47a0a821940889b80007b1b821718dab70a821750da970a7b1a50821608d48606821720dab706821758da9706821710821848821938320238070000024921f8004921f0004921e8007b17e00049211801492110014921000104951700019518e0004921080132029511a0fe7b1058017b1550017b164801951560018411e049213801492130014921280149212001831720013202821918821b10821008d49b07d46008d47808988820d46707977720d4870732029511a07b10587b15507b16489515608411e06476828718828910828a08828832029511c07b10387b15307b16289515408411f0647664173202821750821858821940821a487b67107b68187b697b6a089551808210788215708216689511800032029511807b10787b15707b1668951580008411f06476491118491110491108490149113849113032028217c0007b17388217c8007b17308217d0007b17288217d8007b17209517a00032028218108217087b87088217187b877b861082177b8718955180821078821570821668951180003202828a10828b18828c088289d4cb0bd4a908d4b808988820d4ba0a97aa20d4a8083202951160ff7b1098007b1590007b1688009515a0008411e082897b19188289087b19103202821730018218380182192801821a2001d49808d4a707d487073202827818827910827a0882777b18587b19507b1a487b17409517209518403202955160ff8210980082159000821688009511a0003202849a40520a195109148d9a40cfa80ad09808d09707d4a707320032009597c0d0780733083200849a40520a195109148d9a40d0a70acf9707cf9808d4a808320032009598c0cf870833073200214225a952484992244992244992244992244992244992244992244992244992244992244992542529a524292949a84a494a92244992244992244992244992244992244992244992aa92942451924a92aa2485922425294955559292a4249524254982101286d2a434244244442409494244443422224924244992241111919224499224494a92a4244992a1423515aa344992444a08919a20418224121249121242495242886028499324a9a424499224499224499224a9a424499224499224494892942449920092928888484992a448124522912449922449429224151111252949922484d0888848925292242949922449922449494a49529224091149522222a2101111094912111189101191922449a284d2244992a424499224091149921211114d129224499224841292244992244908850a2194929424492249250925492a499224490aa124499254520a49d22489a49224499224494a922449928452122284489224254945244412044182244992244992645041154d92942449522a4592249582a424411229488a24499224498254aa92a42429922449922449922449915492a414244992a0244a100495a45492121111455222129424495292520a92a4415124882088880491049124915492244992244949922449448204499224499224c9a0822a8a0445922449922449922429924a92948224491294440982a04aa9929488882849894850140922082222412441102448922449922449860aaa680aa568492a494a2449494a502449529224559020882428129148922449924852929254118948921411114992a424292222515292922429495249942449922449212222224444111191888828499224294992925492245592242549a2248994a4a44824128992a4942489929424498a888894a4888824252949922222a22449924a2a4992a4920200",
   ).unwrap();

    let runtime_api_payload = polkadot::apis().revive_api().upload_code(
        dev::alice().public_key().to_account_id(),
        code.clone(),
        None,
    );

    let result = client.runtime_api().at_latest().await?.call(runtime_api_payload).await?.unwrap();
    let deposit_limit = result.deposit;
    dbg!(result);

    let tx_payload = polkadot::tx().revive().upload_code(code.clone(), deposit_limit);
    let res = client
        .tx()
        .sign_and_submit_then_watch_default(&tx_payload, &dev::alice())
        .await?
        .wait_for_finalized()
        .await?;
    
    println!("Transaction finalized: {:?}", res.extrinsic_hash());
    Ok(())
}
